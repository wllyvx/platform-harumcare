---
const { campaigns = [] } = Astro.props;
const campaignsToShow = Array.isArray(campaigns) ? campaigns.slice(0, 3) : [];
const slideCount = campaignsToShow.length > 0 ? campaignsToShow.length : 3;
---
<section class="relative w-full h-[28vh] md:h-[35vh] overflow-hidden">
    <!-- background Slideshow -->
    <div id="slideshow" aria-label="Galeri foto kampanye">
      {campaignsToShow.length > 0 && campaignsToShow.map((c) => (
        <div class="slide absolute inset-0 transition-opacity duration-1000 bg-cover bg-center" style={`background-image: url('${c.imageUrl || "/images/slide1.jpg"}')`}></div>
      ))}
      {campaignsToShow.length === 0 && (
        <>
          <div class="slide absolute inset-0 transition-opacity duration-1000 bg-cover bg-center" style="background-image: url('/images/slide1.jpg')"></div>
          <div class="slide absolute inset-0 transition-opacity duration-1000 bg-cover bg-center" style="background-image: url('/images/slide2.jpg')"></div>
          <div class="slide absolute inset-0 transition-opacity duration-1000 bg-cover bg-center" style="background-image: url('/images/slide3.jpg')"></div>
        </>
      )}
    </div>

    <!-- teks di atas slideshow -->
    <div class="relative z-10 flex items-center justify-center h-full bg-black/60 text-white text-center px-4">
      <div>
        <h1 class="text-2xl md:text-3xl font-bold">
          Buat Perubahan.
        </h1>
        <h1 class="text-2xl md:text-3xl text-blue-200 font-bold mb-3">
          Satu Donasi, Sejuta Harapan
        </h1>
      </div>
      <!-- selector -->
      <div class="absolute bottom-4 md:bottom-6 left-0 right-0 flex justify-center gap-2">
        {Array.from({ length: slideCount }).map((_, i) => (
          <button class={`h-2 w-8 rounded-full ${i === 0 ? "bg-white/60" : "bg-white/30"} indicator`} data-index={i}></button>
        ))}
      </div>
    </div>
  </section>

  <script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    let current = 0;
    const slides = document.querySelectorAll(".slide");
    const indicator = document.querySelectorAll(".indicator")
    const total = slides.length;

    function showSlide(index) {
      slides.forEach((slide, i) => {
        slide.style.opacity = i === index ? "1" : "0";
      });
      indicator?.forEach((indicator, i) => {
        indicator.classList.toggle("bg-white/60", i === index);
        indicator.classList.toggle("bg-white/30", i !== index);
      })
    }

    function nextSlide() {
      current = (current + 1) % total;
      showSlide(current);
    }

    indicator?.forEach((indicator, i) => {
    indicator.addEventListener("click", () => {
      current = i;
      showSlide(current);
      // Reset timer
      slideInterval = setInterval(nextSlide, 5000);
      clearInterval(slideInterval);
    });
  });

    showSlide(current);
    setInterval(nextSlide, 5000); // 5 detik
  });
</script>